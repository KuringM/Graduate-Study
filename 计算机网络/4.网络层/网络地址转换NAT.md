# 网络地址转换NAT(Network Address Translation)

## 传输层**端口号**的概念

> 软件内, 而非硬件端口

![[截屏2025-08-30 10.04.23.png]]

- 网络层实现了**主机到主机**的通信. 网络层在IP数据报的首部, 指明*源IP地址、目的IP地址*
- 传输层实现了**端到端**(进程到进程)的通信. 传输层在 TCP(或UDP)报文段的首部, 指明*源端口、目的端口*
- IP地址+端口号指明一个特定的**进程**

## 私有IP地址(内网IP)

只允许分配给局域网内部的节点, 不允许分配给互联网上的节点

- 10.0.0.0/8: 10.0.0.0~10.255.255.255
- 172.16.0.0/12: 172.16.0.0~172.31.255.255
- 192.168.0.0/16: 192.168.0.0~192.168.255.255

每个局域网内部都可以自行分配这些私有IP地址

私有IP地址是**可复用**的, 只要求*局域网内唯一, 不要求全球唯*

## 全球IP地址(外网IP)

- 通常由ISP提供, 全球唯一
- 外网IP是一个局域网与外界通信时所需使用的IP地址

## NAT路由器

作用: 转发IP数据报时, 进行内网IP、外网IP的相互转换.

**NAT表**, 记录地址转换关系 -- `<内网IP;端口号<=>外网IP;端口号>`.

一个IP数据报

- _从内网转发到外网, 会更改源IP地址、源端口号;_
- _从外网转发到内网, 会更改目的I地址、目的端口号._

**NAT路由器包含传输层的功能**(因为端口号是传输层的概念).

与普通路由器有何区别?

- 普通路由器转发IP数据报时, 不会改变源IP、目的IP地址;
- 普通路由器仅包含网络层及以下的功能.
