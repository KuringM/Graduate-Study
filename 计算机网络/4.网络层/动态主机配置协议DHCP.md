# 动态主机配置协议DHCP

![[IPv4分组#各种协议之间的服务关系]]

- **动态主机配置协议**(Dynamic Host Configuration Protocol, DHCP)常用于给主机动态分配 IP 地址、配置子网掩码、默认网关等网络相关的参数
- _DHCP是应用层协议, 基于UDP提供服务_

## 基本概念

### DHCP协议的作用

给刚接入网络的主机动态分配**IP地址、配置默认网关、子网掩码、租用期**.

### DHCP使用客户/服务器模型(C/S)

DHCP客户

- 就是新接入网络的主机(希望获得I地址等配置)
- DHCP客户端进程, 客户UDP端口号=68

DHCP服务器

- 就是负责分配IP地址的那台主机, 管理一系列IP地址池
- 注: 在家庭网络中, 通常由家庭路由器兼职"DHCP服务器"
- 在一个大型网络内可以有多台DHCP服务器
- DHCP服务器进程, 服务器UDP端口号=67

### DHCP服务器给客户分配IP的过程

![[Pasted image 20250830043505.png]]

1. 客户 -> 服务器: **DHCP发现报文**
   - 携带信息: 客户主机的MAC地址(还可以提出对IP地址租用期的要求)
   - 网络层: `源IP地址=0.0.0.0`, `目的IP地址=255.255.255.255` -- **广播IP数据报**
   - 链路层: `源MAC=客户的MAC地址`, `目的MAC=全1` -- **广播帧**
2. 服务器 -> 客户: **DHCP提供报文**
   - 携带信息: 给客户分配的IP地址、租用期、子网掩码、默认网关
   - 网络层: `源IP=DHCP服务器的IP地址`, `目的IP=255.255.255.255` -- **广播IP数据报** (因为客户还没IP地址)
   - 链路层: `源MAC=服务器的MAC地址`, `目的MAC=客户的MAC地址` -- **单播帧**
3. 客户 -> 服务器: **DHCP请求报文**
   - 携带信息: 客户机确认要使用的IP地址
   - 网络层: `源IP=0.0.0.0`, `目的IP=255.255.255.255` -- **广播IP数据报**
   - 链路层: `源MAC=客户的MAC地址`, `目的MAC=全1` -- **广播帧**
     > 都是广播的原因: 因为网络中可能存在不止一个DHCP服务器, 广而告之所有DHCP Server, 接受谁, 拒绝谁
4. 服务器 -> 客户: **DHCP确认报文**
   - 携带信息: 与报文2类似
   - 网络层: `源IP=DHCP服务器的IP地址`, `目的IP=255.255.255.255` -- **广播IP数据报** (因为客户还没IP地址)
   - 链路层: `源MAC=服务器的MAC地址`, `目的MAC=客户的MAC地址` -- **单播帧**
