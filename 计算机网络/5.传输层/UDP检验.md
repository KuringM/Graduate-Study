# UDP检验

> UDP协议的差错控制

## 一种新的差错检验算法

![[Pasted image 20250830110253.png]]

**检验和的计算**:
将原始数据以16bit为一组, 进行*二进制加法(最高位产生的进位需要**回卷**),加法运算的最终结果逐位取反*,
得到16bit"检验和".

**差错检验方法**:
接收方将收到的内容以16bit为一组, _进行二进制加法(最高位产生的进位需要回卷)_.

- 如果加法结果为全1, 说明没有差错;
- 如果加法结果不是全1, 说明有差错.

## UDP检验(发送方的传输层)

![[Pasted image 20250830110659.png]]

1. 传输层的UDP协议在计算检验和之前, 先添加**伪首部**
2. 把伪首部、首部、数据部分以16bit为一组, 进行二进制加法(最高位产生的进位需要回卷)
3. 将最终的加法结果**逐位取反**, 就得到16bit**检验和**, 将其填入UDP首部
4. 去掉伪首部, 并将UDP数据报交给网络层, 封装成IP数据报

## UDP检验(接收方的传输层)

![[Pasted image 20250830110923.png]]

1. 网络层向传输层递交UDP数据报
2. 传输层在UDP数据报之前, 添加伪首部
3. 把伪首部、UDP首部、数据部分以16bit为一组, 进行二进制加法(最高位产生的进位需要回卷)
4. 如果加法结果为全1, 说明没有比特错误, 于是接收该UDP数据报, 并根据目的端口号, 向应用层递交报文. 如果加法结果不是全1, 说明有差错, 于是丢弃该UDP数据报

### UDP校验要点

- UDP检验和计算方法、差错检验算法如上所示
- 发送方在计算检验和之前, 需要添加伪首部, 计算完校验和之后, 拆除伪首部
- 接收方在差错检验之前, 需要添加伪首部, 检验完之后, 拆除伪首部
  - 如果检验出差错, 就丢弃该UDP数据报
  - 如果无差错, 就接收该UDP数据报
