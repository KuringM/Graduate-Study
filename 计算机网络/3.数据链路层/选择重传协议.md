# 选择重传协议(SR, Selective Repeat)

- 滑动窗口机制: 多滑动窗口, 发送窗口$W_T> 1$, 接收窗口$W_R> 1$
- 确认机制:
  - 确认帧: `ACKi` -- 若接收方收到i号帧, 且没有检测出"差错", 需要给发送方返回确认帧 ACK_i
  - 否认帧: `NAKi` (Negative-Acknowledge)-- 若接收方收到i号帧, 但检测出i号帧有"差错", 需要丢弃该帧, 并给发送方返回否认帧 NAK_i
- 重传机制:
  - 超时重传 -- 若发送方超时未收到ACKi, 则重传i号帧
  - 请求重传 -- 若发送方收到NAK_i, 则重传i号帧
- 帧编号
  - 为了支持以上机制正确运行, 至少需要用 nbit 给帧"编号"
  - 要求: $W_T + W_R \leqslant 2^{n}$
  - 要求: $W_R \leqslant  W_T$, 即接受窗口不能大于发送窗口
  - 在实际应用中, 通常取 $W_T=W_R$
- 要点
  - 若接收方检测出帧差错, 则丢弃帧, 并返回 NAK_i, 主动请求重传
  - 接收方不能"累计确认", 必须"一帧一确认"

选择重传协议如何解决**数据帧丢失**问题: <BR>
超时重传机制:每个帧被发出时设置计时器, 如果超时未收到对应的ACK, 就重传这个帧

选择重传协议如何解决**数据帧因差错而被丢弃**问题: <BR>
**请求重传机制**:如果接收方收到一个有差错的帧, 就将此帧丢弃, 并返回对应的否认帧NAK_i, 主动请求发送方重传 i 号帧

如果不满足 $W_T + W_R \leqslant 2^{n}$ 会有什么问题? <BR>
若不满足$W_T + W_R \leqslant 2^{n}$, 会导致发送方和接收方无法正确判别"重复帧".
