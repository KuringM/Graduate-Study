# 随机访问介质访问控制

## 1. ALOHA协议(Additive Links On-line Hawaii Area)

![[截屏2025-08-29 02.24.59.png]]

### 纯ALOHA

- 节点一旦准备好数据帧, 就立即发送到信道上
- 若超时未收到ACK, 随机等一段时间后重传

![[截屏2025-08-29 02.20.12.png]]

### 时隙ALOHA协议

> 时隙ALOHA避免了用户发送数据的随意性, 降低了冲突概率, 提高了信道的利用率. <BR>
> 时隙 ALOHA 发生冲突时, 发生冲突的各节点随机推迟若干个时隙.

- "时隙"大小固定- 传输一个最长帧所需时间
- 各节点只能在时隙内传输帧, 相比于纯ALOHA, 降低了冲突概率

![[截屏2025-08-29 02.26.39.png]]

## 2. CSMA协议

CSMA (Carrier Sense Multiple Access)协议, 即**载波监听多路访问协议**.

CSMA协议在ALOHA协议基础上提出改进: _在发送数据之前, 先监听信道是否空闲, 只有信道空闲时, 才会尝试发送_.

### 1-坚持CSMA

- 发送前先监听信道, 若信道空闲立即发送数据帧(发送概率为1)
- "坚持'意味着如果信道不空闲, 节点会坚持监听信道

![[Pasted image 20250829023345.png]]

- 优点: 信道利用率高, 信道一旦空闲, 就可以被下一个节点使用.
- 缺点: 当多个节点都已准备好数据时, 一旦信道空闲, 会有多个节点同时发送数据, 冲突概率大.

### 非坚持CSMA协议

- 可记忆为"1-非坚持", 即发送前先监听信道, 若信道空闲立即发送数据帧(发送概率为1)
- "非坚持"意味着如果信道不空闲, 节点不会坚持监听信道, 而是随机推迟一段时间后再尝试监听

![[Pasted image 20250829023440.png]]

- 优点: 当多个节点都已准备好数据时, 如果信道不空闲, 则各节点会**随机推迟一段时间再尝试监听**, 从而使*各节点"错开"发送数据, 降低冲突概率*.
- 缺点: 信道刚恢复空闲时, 可能不会被立即利用, 导致信道利用率降低

### p-坚持CSMA协议

- 发送前先监听信道, 若信道空闲则以概率p 立即发送帧, 以概率1-p推迟一段时间再发送
- "坚持'意味着如果信道不空闲, 节点会坚持监听信道

![[截屏2025-08-29 02.38.44.png]]

- 优点:属于 1-坚持CSMA、非坚持 CSMA 的折中方案, 降低冲突概率的同时, 提升信道利用率

## 3. CSMA/CD协议 ‼️

> CD, Collision Detection: 冲突检测

用于早期的**有线以太网(总线型)**,如:

- 用同轴电缆连接多个节点组成的有线局域网
- 用集线器连接多个节点组成的有线局域网

> 注:现在的有线局域网也使用"以太网"技术, 但不一定都是"总线型"

![[截屏2025-08-29 03.00.33 1.png]]

协议要点

- **先听后发**, **边听边发**, **冲突停发**, **随机重发**
- 如何随机重发?
  - **截断二进制指数退避算法**: 随机等待一段时间 (r倍**争用期**, 其中r是随机数)
    > "争用期"是一段固定大小的时间
    1. 如果$k\leqslant 10$, 在 $[0, (2^{k}-1)]$ 区间随机取一个整数r
    2. 如果$k > 10$,在 $[0, (2^{10}-1)]$ 区间随机取一个整数r
- 特别注意
  - **第10次**冲突, 是"随机重发"的分水岭;
  - **第16次**冲突, 直接躺平, 放弃传帧, 报告上级(网络层).

**争用期**$=2 \times 最大单向传播时延$(考虑距离最远的两个节点)

- 若争用期内未发生冲突, 就不可能再冲突
- CSMA/CD**没有ACK机制**, 若发送过程中未检测到冲突, 就认为帧发送成功

![[Pasted image 20250829031319.png]]

**最短帧长**$=2\times最大单向传播时延\times信道带宽$

- 如果发送方发送的数据帧长度小于最短帧长, 可能会导致发送方"误以为"发送过程中没有发生冲突, 但实际上已经发生了冲突
- 如果实际要发送的数据很少, 可"填充"至合法长度后再发送
- 若接受方收到的帧小于最短帧长, 视为**无效帧**(冲突停发会导致无效帧)

![[截屏2025-08-29 03.22.15.png]]

最长帧长:

- 规定最长帧长可防止某些节点一直占用信道

以太网规定

- 最短帧长=64B;
- 最长帧长=1518B

## 4. CSMA/CA协议 ❗️

> CA, Collision Avoidance: 冲突避免

用于IEEE 802.11无线局域网(WiFi)

协议要点

- 发送方: **先听后发, 忙则退避**
  - 若信道空, **间隔DIFS**后, 再发送帧(一口气发完, 发送过程中不用检测冲突)
  - 若信道不空闲, 则进行"随机退避"
- **随机退避**原理
  1. 用二进制指数退避算法确定一段随机退避时间(倒计时)
  2. 发送方会保持监听信道, 只有信道空闲时才"扣除倒计时", 倒计时结束后立即发送帧(此时信道"听起来"一定空闲)
- 接收方: **停止等待协议**
  - 每收到一个正确数据帧都返回ACK;
  - 若发送方超时未收到ACK, 则进行"随机退避"重发

信道预约机制(可选功能)

> 解决 **隐蔽站** 问题

1. 发送方广播**RTS控制帧**(先听后发, 忙则退避)
2. AP广播**CTS控制帧**
   > 1, 2需在RTS、CTS中指明预约时长
3. 其他无关节点收到CTS后自觉"禁言"一段时间(即:虚拟载波监听机制);发送方收到CTS后, 就可以发送数据帧
4. AP收到数据帧后, 进行CRC校验, 若无差错就返回ACK帧

- RTS控制帧(Request ToSend, 请求发送) -- 它包括源地址、目的地址和这次通信所需的持续时间.
- CTS控制帧(Clear To Send, 允许发送 ) -- 它也包括源地址、目的地址和这次通信所需的持续时间.

> 注1:如果超时未收到CTS, 说明预约失败, 则"随机退避"后再次RTS预约. <BR>
> 注2:"先预约, 再发送"这种模式可以启用、也可以不启用.

**帧间间隔IFS**(Inter Frame Gap)

- DIFS,分布式协调IFT (最长的IFS) -- 每次"帧事务"开始之前需要等待的时间
- SIFS, (最短的IFS) -- 收到一个帧后需要预留的一段处理时间.(如完成差错控制等)
- PIFS, 中等长度的IFS -- 考研可不关注PIFS
