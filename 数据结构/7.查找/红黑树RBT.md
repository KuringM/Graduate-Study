# 红黑树

![[Pasted image 20250904132224.png]]

- 平衡二叉树 AVL: 插入/删除 很容易破坏"平衡"特性, 需要频繁调整树的形态.
  - 如: 插入操作导致不平衡, 则需要先==计算平衡因子, 找到最小不平衡子树(时间开销大)==, 再进行 LL/RR/LR/RL 调整.
- 红黑树 RBT: 插入/删除 很多时候不会破坏"红黑"特性, 无需频繁调整树的形态. 即便需要调整, 一般都可以在==常数级时间内完成==.
- 平衡二叉树: 适用于以查为主、很少插入/删除的场景.
- 红黑树: 适用于频繁插入、删除的场景, 实用性更强.

## 红黑树的定义

- 红黑树是二叉排序树 => `左子树结点值 <= 根结点值 <= 右子树结点值`
- 与普通BST相比, 有什么要求
  1. 每个结点或是红色, 或是黑色的
  2. ==根节点是黑色的==
  3. ==叶结点(外部结点、NULL结点、失败结点)均是黑色的== (不是包含关键字的叶子结点)
     > 在RBT中, "叶结点"通常指"失败结点"(又名: 空叶结点/NULL结点/外部结点)
  4. ==不存在两个相邻的红结点(即红结点的父节点和孩子结点均是黑色)==
  5. ==对每个结点, 从该节点到任一叶结点的简单路径上, 所含黑结点的数目相同==

> 左根右, 根叶黑 <BR>
> 不红红, 黑路同

```c
struct RBnode {   // 红黑树的结点定义
  int key;        // 关键字的值
  RBnode *parent; // 父节点指针
  RBnode *lChild; // 左孩子指针
  RBnode *rChild; // 右孩子指针
  int color; // 结点颜色, 如: 可用 0/1 表示 黑/红, 也可使用枚举型enum表示颜色
};
```

![[Pasted image 20250904135338.png]]

### B.H.

结点的**黑高 bh** -- 从某结点出发(不含该结点)到达任一空叶结点的路径上黑结点总数

![[Pasted image 20250904141438.png]]

思考: 根节点黑高为 h 的红黑树, 内部结点数(关键字)至少有多少个?

- 回答: 内部结点数最少的情况 -- 总共h层黑结点的满树形态
- 结论: ==若根节点黑高为h, 内部结点数(关键字)最少有 $2^h-1$ 个==

## 红黑树的性质

- 性质1: 从根节点到叶结点的最长路径不大于最短路径的2倍
- 性质2: 有n个内部节点的红黑树高度 $h \leqslant  2\log_2 n + 1$

  - 红黑树查找操作时间复杂度= $O(\log_2 n)$
    > 查找效率与AVL树同等数量级

- 性质1证明: 任何一条查找失败路径上黑结点数量都相同, 而路径上不能连续出现两个红结点, 即红结点只能穿插在各个黑结点中间
- 性质2证明: 若红黑树总高度=h, 则根节点黑高 $\geqslant \frac{h}{2}$, 因此内部结点数 $n \geqslant 2^{\frac{h}{2}}-1$, 由此推出 $h \leqslant 2\log_2 (n + 1)$

## 红黑树的查找

- 与 BST、AVL 相同, 从根出发, 左小右大, 若查找到一个空叶节点, 则查找失败
- 复习: 平均查找长度 ASL, 查找成功、查找失败时分别怎么计算?

## 红黑树的插入

从一棵空的红黑树开始, 插入: `20, 10, 5, 30, 40, 57, 3, 2, 4, 35, 25, 18, 22, 23, 24, 19, 18`.

[模拟](https://www.cs.usfca.edu/~galles/visualization/RedBlack.html)

- 先查找, 确定插入位置(原理同二叉排序树), 插入新结点
- 新结点是根 -- 染为黑色
- 新结点非根 -- 染为红色
  - 若插入新结点后依然满足红黑树定义, 则插入结束
  - 若插入新结点后不满足红黑树定义, 需要调整, 使其重新满足红黑树定义
    - ==黑叔: 旋转+染色==
      - LL型: 右单旋, 父换爷+染色
      - RR型: 左单旋, 父换爷+染色
      - LR型: 左、右双旋, 儿换爷+染色
      - RL型: 右、左双旋, 儿换爷+染色
    - ==红叔: 染色+变新==
      - 叔父爷染色, 爷变为新结点

## 红黑树的删除操作

1. 红黑树删除操作的时间复杂度= $O(\log_2 n)$;
2. 在红黑树中删除结点的处理方式和**二叉排序树的删除**一样;
3. 按2删除结点后, 可能破坏"红黑树特性", 此时需要==调整结点颜色、位置==, 使其再次满足"红黑树特性".

- TODO: 难度大,有能力再来吧! <2025/09/04, Kuring>
