# 信号

- 信号量(Semaphore) -- 实现进程间的同步、互斥
- 信号(Signal) -- 实现进程间通信(IPC, Inter Process Communication)

## 信号的作用

信号(signal): 用于通知进程某个特定事件已经发生. 进程收到一个信号后, 对该信号进行处理.

## 实现原理 -- 信号的发送与保存

## 实现原理 -- 信号的处理

When 什么时候处理信号?

- 当进程从内核态转为用户态时(如: 系统调用返回、或中断处理返回时), 例行检查是否有待处理信号, 如果有, 就处理信号

How 怎么处理信号?

1. 执行操作系统为此类信号设置的 缺省(默认)信号处理程序(某些信号默认忽略, 不作处理)
2. 执行进程为此类信号设置 用户自定义信号处理程序(自定义信号处理程序将覆盖1)
   - 信号处理程序运行结束后, 通常会返回进程的下一条指令继续执行(除非信号处理程序将进程阻塞或终止)
   - 一旦处理了某个信号, 就将pending位重置为0
   - 重复收到的同类信号, 将被简单地丢弃(因为仅有 1bit 记录一类待处理信号)
   - 当同时收到多个不同类信号时, 通常先处理序号更小的信号.

## 信号与异常有什么关系?

"信号"可以作为"异常"的配套机制, 让进程对操作系统的异常处理进行补充.

在进程运行过程中, 某些特殊事件可能引发"异常", 操作系统内核负责捕获并处理异常

- 有些异常可以由内核完成全部处理(如: 缺页异常), 此时就不必再使用信号机制.
- 有些异常无法由内核完成全部处理, 可能还需要用户进程配合, 此时就可以用"信号机制"与"异常机制"相互配合
  - 如: 在Linux中, 发生除以0异常时, 内核的异常处理程序会向用户进程发送SIGFPE信号.
  - SIGFPE信号的默认处理程序会将进程终止并转储内存;当然进程可以自定义SIGFPE信号处理程序.
