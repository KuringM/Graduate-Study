# 进程控制

## 什么是进程控制?

进程控制的主要功能是对系统中的所有进程实施有效的管理,
它具有创建新进程、撤销已有进程、实现进程状态转换等功能.

简化理解: 反正进程控制就是要实现进程状态转换

## 如何实现进程控制?

用"原语"实现.

- 原语是一种特殊的程序, 它的执行具有原子性.
- 也就是说, 这段程序的运行必须一气呵成, 不可中断.

## 如何实现原语的"原子性"?

- 原语的执行具有原子性, 即执行过程只能一气呵成, 期间不允许被中断.
- 可以用 "关中断指令"和"开中断指令"这两个特权指令实现原子性.
- 正常情况: CPU每执行完一条指令都会例行检查是否有中断信号需要处理, 如果有, 则暂停运行当前这段.

## 进程的创建

- 创建原语 -- 操作系统创建一个进程时使用的原语
  - 申请空白PCB
  - 为新进程分配所需资源
  - 初始化PCB
  - 将PCB插入就绪队列 -- 创建态之就绪态
- 引起进程创建的事件
  - 用户登录 -- 分时系统中, 用户登承成功, 系統会建立为其建立一个新的速程
  - 作业调度 -- 多道批处理系统中, 有新的作业放入内存时, 会为其建立一个新的进程
  - 提供服务 -- 用户向操作系统提出某些请求时, 全新建一个进程处理该请求
  - 应用请求 -- 由用户进程主动请求创建一个子进程

## 进程的终止

- 撤销原语 -- 就绪态/阻塞态/运行态 -> 终止态 -> 无
  - 从PCB集合中找到终止进程的PCB
  - 若进程正在运行, 立即剥夺CPU, 将CPU分配给其他进程
  - 终止其所有子进程 -- 进程间的关系是树形结构
  - 将该进程拥有的所有资源归还给父进程或操作系统
  - 删除PCB
- 引起进程终止的事件
  - 正常结束 -- 进程自己请求终止(exit系统调用)
  - 异常结束 -- 整数除以O、非法使用特权指令, 然后被操作系统强行杀掉
  - 外界干预 -- Ctrl+Alt+delete, 用户选择杀掉进程

## 进程的阻塞和唤醒 -- 阻塞原语唤醒原语必须成对使用

- 进程的阻塞
  - 阻塞原语 -- 运行态 -> 阻塞态
    - 找到要阻塞的进程对应的PCB
    - 保护进程运行现场, 将PCB状态信息设置为"阻塞态", 暂时停止进程运行
    - 将PCB插入相应事件的等待队列
  - 引起进程阻塞的事件
    - 需要等待系统分配某种资源
    - 需要等待相互合作的其他进程完成工作
- 进程的唤醒
  - 唤醒原语 -- 阻塞态 -> 就绪态
    - 在事件等待队列中找到PCB
    - 将PCB从等待队列移除, 设置进程为就绪态
    - 将PCB插入就绪队列, 等待被调度
  - 引起进程唤醒的事件
    - 等待的事件发生 -- 因何事阻塞, 就应由何事唤醒

## 进程的切换

- 切换原语 -- 运行态 -> 就绪态; 就绪态 -> 运行态
  - 将运行环境信息(进程上下文(Context))存入PCB
  - PCB移入相应队列
  - 选择另一个进程执行, 并更新其PCB
  - 根据PCB恢复新进程所需的运行环境
- 引起进程切换的事件
  - 当前进程时间片到
  - 有更高优先级的进程到达
  - 当前进程主动阻塞
  - 当前进程终止

## 进程控制相关的原语

学习技巧: 进程控制会导致进程状态的转换. 无论哪个进程控制原语, 要做的无非三类事情:

1. 更新PCB中的信息 <BR>
   a. 所有的进程控制原语一定都会修改进程状态标志 <BR>
   b. 剥夺当前运行进程的CPU使用权必然需要保存其运行环境 <BR>
   c. 某进程开始运行前必然要恢复期运行环境
2. 将PCB插入合适的队列
3. 分配/回收资源
