# 多处理机调度

单处理机调度: 只需决定让哪个就绪进程优先上处理机即可.

多处理机调度:

1. 用调度算法决定让哪个就绪进程优先上处理机;
2. 还需决定被调度的进程到底上哪个处理机.

多处理机调度中, 应追求的目标:

- 负载均衡 -- 尽可能让每个CPU都同等忙碌
- 处理机亲和性 -- 尽量让一个进程调度到同一个CPU上运行, 以发挥CPU中缓存的作用(Cache)

## 公共就绪队列

- 所有CPU共享同一个就绪进程队列(位于内核区)
- 每个CPU时运行调度程序, 从公共就绪队列中选择一个进程运行
- 每个CPU访问公共就绪队列时需要上锁(确保互斥)
- 优点: 可以天然地实现负载均衡
- 缺点: 各个进程频繁地换CPU运行, "亲和性"不好

如何提升处理机亲和性?

- 软亲和: 由进程调度程序尽量保证"亲和性"
- 硬亲和: 由用户进程通过系统调用, 主动要求操作系统分配固定的CPU, 确保"亲和性"

## 私有就绪队列

- 每个CPU都有一个私有就绪队列;
- CPU空闲时运行调度程序, 从私有就绪队列中选择一个进程运行.

如何实现负载均衡?

推迁移(Push)策略:
一个特定的系统程序周期性检查每个处理器的负载,
如果负载不平衡, 就从忙碌CPU的就绪队列中"推"一些就绪进程到空闲CPU的就绪队列.

拉迁移(pull)策略:
每个CPU运行调度程序时, 周期性检查自身负载与其他CPU负载.
如果一个CPU负载很低, 就从其他高负载CPU的就绪队列中"拉"一些就绪进程到自己的就绪队列.

如何提升处理机亲和性?

- 私有就绪队列天然地实现了"处理机亲和性"
