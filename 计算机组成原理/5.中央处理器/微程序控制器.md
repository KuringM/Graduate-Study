# 微程序控制器

## 1. 微程序控制的基本概念

- 指令是对程序执行步骤的描述
- 微指令是对指令执行步骤的描述
- 指令是对微指令功能的"封装"
- 程序:由**指令序列**组成
- 微程序:由微指令序列组成, 每一种指令对应一个微程序

## 2. 微程序控制器的组成和工作过程

![[Pasted image 20250825222603.png]]

- 微地址形成部件: 产生初始微地址和后继微地址, 以保证微指令的连续执行.
- CMAR, 别名:μPC, 微地址寄存器, 接收微地址形成部件送来的微地址, 为在CM中读取微指令作准备.
- 控制存储器CM, 用于存放各指令对应的微程序, 控制存储器可用只读存储器ROM构成
- CMDR, 别名:μIR, 微指令寄存器, 用于存放从CM中取出的微指令, 它的位数同微指令字长相等

## 3. 微指令的格式

1. 水平型微指令: 一条微指令能定义多个可并行的微命令.

   - 优点:微程序短, 执行速度快;
   - 缺点:微指令长, 编写微程序较麻烦.

2. 垂直型微指令 一条微指令只能定义一个微命令, 由微操作码字段规定具体功能

   - 优点:微指令短、简单、规整, 便于编写微程序;
   - 缺点:微程序长, 执行速度慢, 工作效率低.

3. 混合型微指令 在垂直型的基础上增加一些不太复杂的并行操作.

   - 微指令较短, 仍便于编写;微程序也不长, 执行速度加快

## 4. 微指令的编码方式

![[Pasted image 20250825225312.png]]

1.  在微指令的操作控制字段中, 每一位代表一个微操作命令某位为 "1" 表示该控制信号有效

    - 优点:简单、直观, 执行速度快, 操作并行性好.
    - 缺点:微指令字长过长, n个微命令就要求微指令的操作字段有n位, 造成控存容量极大.

2.  字段直接编码方式将微指令的控制字段分成若干 "段", 每段经译码后发出控制信号

    - 优点:可以缩短微指令字长 .
    - 缺点:要通过译码电路后再发出微命令, 因此比直接编码方式慢 .

3.  字段间接编码方式: 一个字段的某些微命令需由另一个字段中的某些微命令来解释, 由于不是靠字段直接译码发出的微命令, 故称为字段间接编码, 又称隐式编码.

    - 优点:可进一步缩短微指令字长.
    - 缺点:削弱了微指令的并行控制能力, 故通常作为字段直接编码方式的一种辅助手段.

微命令字段分段的原则:

1.  互斥性微命令分在同一段内, 相容性微命令分在不同段内.
2.  每个小段中包含的信息位不能太多, 否则将增加译码线路的复杂性和译码时间.
3.  一般每个小段还要留出一个状态, 表示本字段不发出任何微命令.
    因此, 当某字段的长度为3位时, 最多只能表示7个互斥的微命令, 通常用000表示不操作.

## 5. 微指令的地址形成方式

1. 微指令的 **下地址字段** 指出:
   微指令格式中设置一个下地址字段, 由微指令的下地址字段直接指出后继微指令的地址, 这种方式又称为**断定方式**.
2. 根据机器指令的 操作码 形成:
   当机器指令取至指令寄存器后, 微指令的地址由操作码经微地址形成部件形成.
3. **增量计数器法**: $( CMAR ) + 1 \to CMAR$
4. 分支转移:
   转移方式:指明判别条件;转移地址:指明转移成功后的去向.
5. 通过测试网络微指令的地址形成方式
6. 由硬件产生微程序入口地址 <BR>
   第一条微指令地址: 由专门 硬件 产生(用专门的硬件记录取指周期微程序首地址) <BR>
   中断周期: 由硬件产生 中断周期微程序首地址(用专门的硬件记录)

## 6. 硬布线与微程序的比较

![[Pasted image 20250825232324.png]]

# 微程序控制单元的设计

设计步骤:

1. 分析每个阶段的微操作序列
2. 写出对应机器指令的微操作命令及节拍安排
3. 确定微指令格式
4. 编写微指令码点
