# 数据通路的操作举例

总线是一组共享的传输信号线, 它不存储信号, 任一时刻也只能有一个部件把信号送到总线上.

## CPU内部单总线方式

### 1. 寄存器之间数据传送

比如把PC内容送至MAR, 实现传送操作的流程及控制信号为:

- $(PC)\to Bus$, PCout有效, PC内容送**总线(Bus)**
- $Bus\to MAR$, MARin有效, 总线内容送MAR

> 也可写为: $(PC)\to Bus\to MAR$, 也有的教材写为: $PC\to Bus\to MAR$

### 2. 主存与CPU之间的数据传送

比如CPU从主存读取指令, 实现传送操作的流程及控制信号为:

- $(PC)\to Bus\to MAR$, PCout和MARin有效, $现行指令地址\to MAR$
- $1\to R$, **CU发读命令**(通过控制总线发出, 图中未画出)
- $MEM(MAR)\to MDR$, MDRin有效
- $MDR\to Bus\to IR$, MDRout和IRin有效, $现行指令\to IR$

### 3. 执行算术或逻辑运算

比如一条加法指令, 微操作序列及控制信号为:

- $Ad(IR)\to Bus\to MAR$, MDRout和MARin有效(或AdIRout和MARin有效)
- $1\to R$, CU发读命令
- $MEM(MAR)\to 数据线\to MDR$, MDRin有效
- $MDR\to Bus\to Y$, MDRout和Yin有效, $操作数\to Y$
- $(ACC)+(Y)\to Z$, ACCout和ALUin有效, CU向ALU发送加命令
- $Z\to ACC$, Zout和ACCin有效, $结果\to ACC$

### 例题

设有如图所示的**单总线结构**, 分析指令 `ADD (R0),R1` 的指令流程和控制信号.

![[Pasted image 20250825162851.png]]

#### 1. 分析指令功能和指令周期

- 功能: `((R0))+(R1)→(R0)`
- 指令周期: 取指周期、间址周期、执行周期

#### 2. 写出各阶段的指令流程

取指周期:公共操作

| 时序 |                微操作                 |     有效控制信号     |
| :--: | :-----------------------------------: | :------------------: |
|  1   |             $(PC)\to MAR$             |     PCout, MARin     |
|  2   | $M(MAR) \to MDR$ <BR> $(PC)+1 \to PC$ | MemR, MARout, MDRinE |
|  3   |            $(MDR) \to IR$             |     MDRout, IRin     |
|  3   |               指令译码                |          -           |

间址周期:完成取数操作, 被加数在主存中, 加数已经放在寄存器R1中.

| 时序 |                微操作                 |     有效控制信号     |
| :--: | :-----------------------------------: | :------------------: |
|  1   |             $(R0)\to MAR$             |     R0out, MARin     |
|  2   | $M(MAR) \to MDR$ <BR> $(PC)+1 \to PC$ | MemR, MARout, MDRinE |
|  3   |             $(MDR) \to Y$             |     MDRout, Yin      |

执行周期:完成取数操作, 被加数在主存中, 加数已经放在寄存器R1中.

| 时序 |      微操作       |             有效控制信号             |
| :--: | :---------------: | :----------------------------------: |
|  1   | $(R1)+(Y) \to Z$  | R1out, ALUin, CU向ALU发出ADD控制信号 |
|  2   |   $(Z)\to MDR$    |             Zout, MDRin              |
|  3   | $(MDR)\to M(MAR)$ |        MemW, MDRoutE, MARout         |

## 专用数据通路方式

![[Pasted image 20250825165317.png]]

|    微操作    |       有效控制信号       |
| :----------: | :----------------------: |
|  `(PC)→MAR`  |          C0有效          |
| `(MAR)→主存` |          C1有效          |
|    `1→R`     | 控制单元向主存发送读命令 |
| `M(MAR)→MDR` |          C2有效          |
|  `(MDR)→IR`  |          C3有效          |
| `(PC)+1→PC`  |                          |
| `Op(IR)→CU`  |          C4有效          |
