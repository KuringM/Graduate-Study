# 定点数的加减运算

## 1. 原码的加减法运算

原码的加法运算:

- 正+正: 绝对值做加法, 结果为正(可能产生溢出)
- 负+负: 绝对值做加法, 结果为负(可能产生溢出)
- 正+负: 绝对值大的减绝对值小的, 符号同绝对值大的数
- 负+正: 绝对值大的减绝对值小的, 符号同绝对值大的数

原码的减法运算, "减数"符号取反, 转变为加法:

- 正-负$\to$正+正
- 负-正$\to$负+负
- 正-正$\to$正+负
- 负-负$\to$负+正

## 2. 补码的加减运算

运算公式(设机器字长为n+1):

$$
\begin{aligned}
	& [A+B]_{补} = [A]_{补}+ [B]_{补} (\text{mod } 2^{n+1}) \\
	& [A-B]_{补} = [A]_{补}+ [-B]_{补} (\text{mod } 2^{n+1})
\end{aligned}
$$

- 按⼆进制运算规则算就可以了
- 符号位和数值位⼀起参与运算
- 运算结果的高位丢弃

带符号数(补码)的加法:从最低位开始, 按位相加(符号位参与运算), 并往更高位进位.

带符号数(补码)的减法:

1. "被减数"不变, "减数"全部位按位取反、末位+1, 减法变加法
2. 从最低位开始, 按位相加, 并往更高位进位

### 无符号位的加减运算

无符号整数的加法:从最低位开始, 按位相加, 并往更高位进位.

计算机硬件如何做无符号整数的减法:

1. "被减数"不变, "减数"全部位按位取反、末位+1(求补数), 减法变加法(加补数)
2. 从最低位开始, 按位相加, 并往更高位进位(自动模运算)

#### 无符号数加法/减法的溢出判断

手算判断溢出的方法:n bit 无符号整数表示范围 $0\sim 2^{n}-1$, 超出此范围则溢出.

计算机判断溢出的方法:

- 无符号数加法的溢出判断:最高位产生的进位=1时, 发生溢出, 否则未溢出.
- 无符号数减法的溢出判断:减法变加法, 最高位产生的进位=0时, 发生溢出, 否则未溢出.

## 3. 判断溢出

- **上溢**: 只有"正数+正数 "才会上溢--正+正=负
- **下溢**: 只有"负数+负数 "才会下溢--负+负=正

方法一: **采用一位符号位**: 参与操作的两个数符号相同, 结果⼜与原操作数符号不同, 则溢出.

设A的符号为$A_S$, B的符号为$B_S$, 运算结果的符号为$S_S$, 则溢出逻辑表达式为

$$
V = A_S B_S \overline{S_S} + \overline{A_S} \overline{B_S} S_S
$$

- 若V=0, 表示无溢出;
- 若V=1, 表示有溢出.
- $A_S为1且B_S为1且S_S为0(负+负=正) 或 A_S为0且B_S为0且S_S为1(正+正=负)$

---

方法二:采用一位符号位, 根据数据位进位情况判断溢出.

设符号位的进位$C_S$, 最高数值位的进位$C_1$,
当$C_S$与$C_1$**不同**时有溢出, 则溢出逻辑判断表达式为

$$
V= C_S \oplus C_1
$$

- 若V=0, 表示无溢出;
- 若V=1, 表示有溢出.

---

方法三: **采用双符号位**: 正数符号为00, 负数符号为11.

- 双符号位补码又称:模4补码(实际存储时只存储1个符号位, 运算时会复制一个符号位)
- 单符号位补码又称:模2补码

记两个符号位为$S_{S_1}S_{S_2}$ ,当两符号位不同溢出, 则

$$
V= S_{S_1} \oplus S_{S_2}
$$

- 若V=0, 表示无溢出;
- 若V=1, 表示有溢出.

## 4. (补码)加减运算电路

![[Pasted image 20250817105252.png]]

> Sub(Substraction,减法): 加法0; 减法1 <BR>
> 无符号整数的加法/减法也可用该电路实现

- n bit补码 $X + Y= [x]_补 + [y]_补$, 按位相加即可
- n bit补码 $X - Y= X + \overline{Y}+1 = [x]_补 + [-y]_补$, 将减数Y全部按位取反, 末位+1, 得到[-Y]补, 减法变加法
- **OF(Overflow Flag)溢出标志**,$OF= C_n \oplus C_{n-1}$用于判断带符号数加减运算是否溢出. **OF=1 溢出;OF=0 未溢出**
- **SF(Sign Flag)符号标志**, $SF=F_{n-1}$用于判断带符号数加减运算结果的正负性. **SF=1 结果为负;SF=0 结果为正**
- **ZF(Zero Flag)零标志**, 用于判断加减运算结果是否为0. **ZF=1 表示结果为0;ZF=0 表示结果不为0**
- **CF(Carry Flag)进位/借位标志**,$CF=C_{out}\oplus C_{in}$用于判断无符号数加减运算是否溢出. **CF=1 溢出;CF=0 未溢出**
