# 浮点数的表示

## 1. 浮点数的表示格式

$$
N= (-1)^S \times M \times R^E
$$

- 符号S: 决定数值的正负性;
- 尾数M: 是一个二进制定点小数, 影响数值的精度, 尾数的位数越多, 精度越高;
- 阶码E: 反映小数点的实际位置;
- 基数R: R进制通常默认基数为R
- 规格化: 确保尾数的**最高位非0数位**刚好在小数点之前

## 2. IEEE754标准

C语言float型32位: 1bit(符号) + 8bit(阶码)+ 23bit(尾数)

C语言double型64位: 1bit(符号) + 11bit(阶码)+ 52bit(尾数)

> 注:IEEE 754 也定义了 80bit 扩展精度浮点型( C语言 long double)、16bit半精度浮点型、128bit四倍精度浮点型

### float 单精度浮点型的存储

- 符号的存储: 0 正 1 负
- 尾数的存储: 规定小数点位置在23bit之前. **默认存储规格化尾数, 小数点前的 1 省略(隐含)**
- 阶码的存储: 用**移码**表示, **规定偏置值为 127**($2^{n-1}-1: 2^{7}-1$)
- 基数: 基数不用专门存储, 规定基数为2即可

#### 如何将十进制真值转换为偏置值为M的移码?

1. 将十进制真值 + 偏置值
2. 按"无符号整数"规则转换为指定位数

### double 双精度浮点型的存储

- 符号的存储: 0 正 1 负
- 尾数的存储: 规定小数点位置在52bit之前. **默认存储规格化尾数, 小数点前的 1 省略(隐含)**
- 阶码的存储: 用移码表示, **规定偏置值为 1023**($2^{n-1}-1: 2^{10}-1$)
- 基数 :基数不用专门存储, 规定基数为2即可

### 重要题型

真值转浮点数

1. 先将十进制真值转为"二进制科学计数法"
2. 转为题目要求的浮点数格式 **符号, 阶码, 尾数**(注意规格化尾数小数点前隐含1)

浮点数转真值

1. 拆解[符号, 阶码, 尾数]

   - [符号]按正0负1解读
   - [阶码]需要将移码转真值(注意偏置值)
   - [尾数]注意处理隐含1

2. 写出"二进制科学计数法", 再转为十进制真值

做题技巧

- 真值转移码: 先将十进制真值+偏置值, 再按"无符号整数"规则转换为指定位数
- 移码转真值: 先按"无符号整数"规则解读二进制, 再减掉移码偏置值
- 复杂十进制小数转二进制—乘积取整法

## 3. IEEE754浮点数几种特殊状态

规格化浮点数解读方法:

- 符号:0正1负
- 阶码:真值 = 按无符号整数解读阶码, 再减偏置值
- 尾数:小数点前面隐含一

IEEE 754 标准规定:

- 仅当阶码不全为0、也不全为1时, 表示这是一个"规格化浮点数"
- 阶码全为0、全为1 留作特殊用途, 需要按照特殊的方式去解读真值

![[Pasted image 20250818163119.png]]

## 4. IEEE754浮点数表示范围

规格化单精度浮点数的真值为

$$
(-1)^s \times 1.f \times 2^{e-127}
$$

> 移码转真值:先按"无符号整数"解读阶码二进制串, 再减掉偏置值, 得到真值.<BR>
> 8 bit 无符号数表示范围 0~255, 除去全0和全1, 则取值范围为 1~254.

先按无符号数解读阶码e, 则取值范围为 1~254, 减掉偏置值 127; **阶码的真值取指范围为 -126 ~ 127**.

![[Pasted image 20250818160240.png]]

运算结果大于最大规格化正数时称为**正上溢**, 小于绝对值最大的规格化负数时称为**负上溢**.

浮点数上溢(溢出)的处理:

1.  浮点数运算部件将运算结果设为设置为 $+\infty$ 或 $-\infty$
2.  设置浮点数溢出异常标志位(例如:x86会将浮点运算单元FPU的OE标志位 Overflow Exception 置为1)

> 注: IEEE 754 规定, 默认不响应浮点数溢出异常, 不中断程序;除非程序员手动开启此类异常响应

若浮点数运算结果在 0 至绝对值最小的规格化正数之间时称为**正下溢**,
在 0 至绝对值最小规格化负数之间时称为**负下溢**. 正下溢和负下溢统称下溢(Underflow)

浮点数运算结果下溢时的处理:

1. 若结果落入非规格化区间 → 用非规格化浮点数存储;若结果太小(真值逼近于0)→ 按机器零存储
2. 若下溢至机器零, 设置浮点数下溢异常标志位(例如:x86会将FPU的UE标志位 Underflow ExcepLon 置1)

> 注: IEEE 754 规定, 默认不响应浮点数下溢异常, 不中断程序;除非程序员手动开启此类异常响应

### 无穷大的表示

float:

- $+\infty$ 0 11111111 00000000000000000000000 0x7F800000
- $-\infty$ 1 11111111 00000000000000000000000 0xFF800000

double:

- +∞ 0 11111111111 000^000 (52bit 0) 0x7FF0000000000000
- −∞ 1 11111111111 000^000 (52bit 0) 0xFFF0000000000000

### 真值0 的表示

float:

- +0 0 00000000 00000000000000000000000 0x00000000
- -0 1 00000000 00000000000000000000000 0x80000000

double:

- +0 0 00000000000 000^000 (52bit 0) 0x0000000000000000
- -0 1 00000000000 000^000 (52bit 0) 0x8000000000000000

## 5. IEEE745非规格化浮点数的表示

![[Pasted image 20250818161417.png]]
![[Pasted image 20250818164020.png]]
float:

- 绝对值最小的非规格化正数: 0 00000000 00000000000000000000001; 真值 $= 0. 00000000000000000000001 \times 2^{126} = 2^{149}$
- 绝对值最大的非规格化正数: 0 00000000 11111111111111111111111; 真值 $= 0. 11111111111111111111111 \times 2^{126} = (1−2^{−23}) \times 2^{−126} = 2^{−126} - 2^{-149}$
- 绝对值最小的非规格化负数: 1 00000000 00000000000000000000001; 真值 $= - 0. 00000000000000000000001 \times 2^{-126}  = - 2^{-149}$
- 绝对值最大的非规格化负数: 1 00000000 11111111111111111111111; 真值 $= - 0. 11111111111111111111111 \times 2^{-126}  = - (1−2^{-23}) \times 2^{-126} = - (2^{-126} - 2^{-149})$

## 6. IEEE 745: 非数(NaN)的表示

![[Pasted image 20250818162606.png]]

在 IEEE 754 浮点数标准中:NaN 代表"不是一个数"(Not a Number)

运算结果为 NaN 的典型例子:

- 0除以0 0.0f / 0.0f // NaN
- 负数开根号 sqrt(-1.0f) // NaN
- 无穷减无穷 ∞ - ∞ // NaN

特别地: 非零数值除以0

- 1.0f / 0.0f; // +∞
- 1.0f / 0.0f; // -∞

![[Pasted image 20250818163449.png]]
