# DMA方式

- ⼀种完全由硬件进⾏成组信息传送的控制⽅式
- 在数据准备阶段, CPU与外设并⾏⼯作, 在外设与内存之间开辟⼀条"直接数据通路", 信息传送不再经过CPU(也就不需要保护、恢复CPU现场等操作), 降低了CPU在传送数据时的开销

## DMA方式的特点

1. 主存既可以被CPU访问, 也可被外设访问
2. 在数据块传送时, 主存地址的确定、传送数据等都由硬件电路直接实现
3. 主存中要开辟专⽤缓冲区, 及时供给和接收外设的数据
4. DMA传送速度快, CPU和外设并⾏⼯作, 提⾼了系统效率
5. DMA在传送开始前要通过程序进⾏预处理, 结束后要通过中断⽅式进⾏后处理

## 什么是DMAC

DMAC⼜叫DMA控制器, 是对数据传送过程进⾏控制的硬件
在DMA过程中, DMAC将接管CPU的地址总线、数据总线和控制总线, CPU的主存控制信号被禁⽤

## DMAC的功能

1. 接收外设发出的DMA请求, 并向CPU发出总线请求
2. CPU响应此总线请求, 发出总线响应信号, 接管总线控制权, 进⼊DMA操作周期
3. 确定传送数据的主存单元地址及⻓度, 并⾃动修改主存地址计数和传送⻓度计数
4. 规定数据在主存和外设间的传送⽅向, 发出读写等控制信号, 执⾏数据传送操作
5. 向CPU报告DMA操作结束

## DMAC(DMAC控制器)的组成

![[Pasted image 20250828000420.png]]

![[Pasted image 20250828000739.png]]

- 存地址计数器 存放要交换数据的主存地址
- 传送⻓度计数器 记录传送数据的⻓度, 技术溢出时, 数据传输即完毕, ⾃动发送中断请求信号
- 数据缓冲寄存器 暂存每次传送的数据
- DMA请求触发器 每当I/O设备准备好数据后, 给出⼀个控制信号, 使DMA请求触发器置位
- "控制/状态"逻辑 由控制和时序电路及状态标志组成, ⽤于指定传送⽅向, 修改传送参数, 并对
- DMA请求信号、CPU响应信号进⾏协调和同步.
- 中断机构 当⼀个数据块传送完毕后触发中断机构, 向CPU提出中断请求

## DMA传送过程

![[Pasted image 20250828001720.png]]

1. 预处理
   - 由CPU完成⼀些必要的准备⼯作
2. 数据传送
   - 可以以单字节(或字)为基本单位
   - 也可以以数据块为基本单位(此时通过循环实现)
3. 后处理
   - DMAC向CPU发出中断请求
   - CPU执⾏中断服务程序做DMA结束处理
   - 后处理包括
     - 校验送⼊主存的数据是否正确
     - 测试传送过程中是否出错(错误则转诊断程序)
     - 决定是否继续使⽤DMA传送其他数据等

## DMA传送方式

当I/O设备和CPU同时访问主存时, 可能发⽣冲突, 为了有效使⽤主存, DMAC控制器和CPU通常采⽤3种⽅式使⽤主存

1. 停⽌CPU访问
2. 周期挪⽤:I/O访存优先级⾼于CPU访存, 因为I/O不⽴即访存就可能会丢失数据, 此时由I/O设备挪⽤⼏个存取周期
3. DMA与CPU交替访问:适⽤于CPU⼯作周期⽐主存存取周期⻓的情况.

## DMA方式与中断方式

![[Pasted image 20250828001838.png]]

